# with_filetree: '{{ ansible_env.HOME }}/machine/ansible/roles/terraplate/{{ provider }}'
# with_filetree: '{{ terraplate_dir }}/{{ provider }}'
---
- name: Read the directory list of resources in the terraplate repo and include a task list for each resource
  include_tasks: render.yml resource_name={{ resource.path.split("/")[0:-2] | join("/") }}
  with_filetree: '{{ terraplate_provider_roles_dir }}'
  when: resource.path.split("/")[-1] == 'main.tf.j2'
  loop_control:
    loop_var: resource

- debug: msg='Terraform resources written to {{ terraplate_provider_roles_dir }}'
