# Backend Configuration - required by Terraform; supplied by Terragrunt
terraform {
  backend "s3" {}
}


### Providers
{% for provider in terraplate_component.vars.api_providers %}
# {{ provider }}
{% for key in terraplate_providers[provider] %}
variable "provider_{{ provider }}_{{ key | replace('-', '_') }}" {}
{% endfor %}

provider "{{ provider }}" {
{% for key in terraplate_providers[provider] %}
  {{ key }} = "${var.provider_{{ provider }}_{{ key }}}"
{% endfor %}
}

{% endfor %}

### Remote Data Sources
{% for provider in terraplate_component.vars.api_remote_states %}
# {{ provider }}
variable "remote_state_{{ provider | replace('-', '_') }}_bucket" {}
variable "remote_state_{{ provider | replace('-', '_') }}_key" {}
variable "remote_state_{{ provider | replace('-', '_') }}_region" {}

data "terraform_remote_state" "{{ provider }}" {
  backend = "s3"
  config {
    bucket = "${var.remote_state_{{ provider | replace('-', '_') }}_bucket}"
    key    = "${var.remote_state_{{ provider | replace('-', '_') }}_key}/terraform.tfstate"
    region = "${var.remote_state_{{ provider | replace('-', '_') }}_region}"
  }
}
{% endfor %}
